---
title: "Student 3000 Criminal Data"
author: "5조 강준호,권우민,임일화, 김지연"
date: '`r Sys.Date()`'
output: html_document
---

## Structure of Data


### Data Manipulation

•W. S. Gosset 이 t-분포를 유도하느라고 모의실험에 활용한 자료는 다음과 같음. ◦table은 본질적으로 matrix임. 행과 열의 이름에 측정값을 글자로 새겨 넣었기 때문에 long format으로 변환할 때 많은 주의가 필요함.


```{r,echo = FALSE}
# options(width=132)
library(ggplot2)
library(knitr)
library(pander)
crimtab
str(crimtab)
```

Gosset 자료를 표로 정리함.
```{r}
kable(crimtab)
```

* 이러한 table 구조의 행과 열에 이름을 붙이려면, list로 부여 ◦cm 단위로 되어 있는 키의 계급을 인치 단위로 변환하면 숨어있던 자료구조다 드러남.

```{r}
dimnames(crimtab)
crimtab.2 <- crimtab
colnames(crimtab.2) <- as.numeric(colnames(crimtab.2))/2.54
(dimnames(crimtab.2) <- list(finger = rownames(crimtab.2), height = colnames(crimtab.2)))
crimtab.2
str(crimtab.2)
```

crimtab을 인치(inches)로 줄여서 나타낸 표.
```{r}
kable(crimtab.2)
```

* `long format` 으로 변환 ◦1차적으로 각 손가락 길이와 키의 조합을 갖는 인원수로 구성된 `data frame`으로 변환하고, case 단위의 `long format data frame`으로 2단계 변환
◦ `as.data.frame()` 에서 `stringsAsFactors = FALSE`가 매우 중요한 역할을 하는 것임. 이 옵션을 설정하지 않을 경우 Factor로 잡히면 numeric으로 전환할 수 없게 됨. Factor는 본질적으로 음이 아닌 정수로 취급됨.
◦보통 이 설정은 ` stringsAsFactors = default.stringsAsFactors()`가 default 설정으로 되어 있고, 따라서 `default.stringsAsFactors() = FALSE` 에 따라 설정을 바꿔주면 되어야 하나 써 있는 대로 되지 않는 경우가 있어서 가능한 설정해주는 것이 안전함.
◦단순히 `data.frame()`으로 변환할 경우 Factor로 설정되어 `numeric`으로 변환하더라도 의미없는 숫자를 얻게 됨.
◦`as.data.frame()`의 결과물로 두 개의 `character vector` 와 `counts`를 나타내는 새로운 변수 Freq가 나오게 됨. 손가락 길이와 키를 나타내는 `character`를 `numeric`으로 전환하고 다음 작업 진행.

    
```{r}
crimtab.2.df <- as.data.frame(crimtab.2, stringsAsFactors = FALSE)
str(crimtab.2.df)
crimtab.2.df[1:2] <- sapply(crimtab.2.df[1:2], as.numeric)
str(crimtab.2.df)
crimtab.2.long <- mapply(function(x) rep(x, crimtab.2.df$Freq), crimtab.2.df[c("finger", "height")])
# crimtab.2.long <- mapply(function(x, y) rep(x, y = crimtab.2.df$Freq), crimtab.2.df[c("finger", "height")])
# crimtab.2.long <- mapply(function(x, y) rep(x, y), y = crimtab.2.df$Freq, crimtab.2.df[c("finger", "height")])
# crimtab.2.long <- mapply(function(x) rep(x, crimtab.2.df$Freq), crimtab.2.df[, c("finger", "height")])
# crimtab.2.long <- mapply(function(x) rep(x, crimtab.2.df$Freq), crimtab.2.df[1:2])
# crimtab.2.long <- mapply(function(x) rep(x, crimtab.2.df$Freq), crimtab.2.df[, 1:2])
# crimtab.2.long <- mapply(function(x) rep(x, crimtab.2.df$Freq), crimtab.2.df[, 2])
# crimtab.2.long <- mapply(function(x) rep(x, crimtab.2.df$Freq), crimtab.2.df$height)
str(crimtab.2.long)
crimtab.2.long.df <- data.frame(crimtab.2.long)
str(crimtab.2.long.df)
```

## Graphic Representation

### Base Graphics

*키와 손가락길이의 산점도

```{r}
plot(finger ~ height, data = crimtab.2.long.df)
abline(lm(finger ~ height, data = crimtab.2.long.df)$coefficient)
crimtab.lm <- lm(finger ~ height, data = crimtab.2.long.df)
summary(crimtab.lm)
```


```{r}
plot(finger ~ height, data = crimtab.2.long.df)
abline(lm(finger ~ height, data = crimtab.2.long.df)$coefficient)
lines(lowess(crimtab.2.long.df$height, crimtab.2.long.df$finger),col = "red")
```

##각 변수들 정규성을 검정

많은 통계적 추론에서는 자료의 독립성과 정규성(자료가 정규분포를 따른다 것을 의미함)을 가정한다. 따라서 자료의 정규성을 가정하는 통계학적인 분석 방법을 적용하고자 하는 경우에 자료가 정규분포를 따르는지 검정하고자 하는 의미에서 Q-Q 산점도를 이용한다. 

*키와 관련된 정규성 검정
```{r}
qqnorm(crimtab.2.long.df$height)
````

*손가락과 관련된 정규성 검
```{r}
qqnorm(crimtab.2.long.df$finger)
````

위의 그림을 통해, Q-Q 산점도에 나타나는 두 변수가 직선형태를 나타낸다. 즉, 자료가 정규분포에 가깝다는 것을 의미한다.

##각 변수들 빈도표 작성.

*키와 관련된 빈도표.
```{r}
crimtab.2.long.df$height
table(crimtab.2.long.df$height)
(height <- table(crimtab.2.long.df$height))
str(height)
data.frame(height)
(height.table <- data.frame(height))
str(height.table)
dimnames(height.table)<-list(c("1","2","3","4","5","6","7","8","9","10","11",
"12","13","14","15","16","17","18","19","20"),c("키","빈도수"))
pander(height.table)
````

*손가락와 관련된 빈도표.
```{r}
crimtab.2.long.df$finger
table(crimtab.2.long.df$finger)
(finger <- table(crimtab.2.long.df$finger))
str(finger)
data.frame(finger)
(finger.table <- data.frame(finger))
str(finger.table)
dimnames(finger.table)<-list(c("1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38"),c("손가락","빈도수"))
pander(finger.table)
````

##각 변수들을 히스토그램으로 그리기.

*키의 히스토그램 

```{r fig.width=8, fig.height=4}
hist(crimtab.2.long.df$height, main="Histogram of Height", xlab="height(inches)")
```


*손가락의 히스토그램
```{r fig.width=8, fig.height=4}
hist(crimtab.2.long.df$finger, main="Histogram of Finger Length", xlab= "finger length(cm)")
```


##키의 정규곡선 그리기. 

```{r}
hist(crimtab.2.long.df$height, probability = TRUE)
(crimtab.height <- hist(crimtab.2.long.df$height, plot = FALSE))
list(breaks = crimtab.height$breaks, counts = crimtab.height$counts, density = crimtab.height$density, mids = crimtab.height$mids)
crimtab.2.hist <- hist(crimtab.2.long.df$height, probability = TRUE, breaks = 55:78)
```

•히스토그램을 보기 쉽게 하기 위해서 메인 타이틀과 서브 타이틀, x축 라벨, y축 라벨 설정 및 평균을 중심으로 ± 표준편차 만큼 떨어진 자료를 붉은 색 수직점선으로 표시.
```{r}
main.title <- "The historgram of height in crimtab"
x.lab <- "Inches"
y.lab <- "Proportion"
hist(crimtab.2.long.df$height, breaks = 55:78, probability = TRUE, main = main.title, xlab = x.lab, ylab = y.lab)
abline(v = c(63, 68), lty = 2, col = "red")
```

•5개의 직사각형으로 파악하고 향후 면적 계산을 쉽게 하기 위하여 다음과 같이 좌표 설정
```{r}
y <- crimtab.2.hist$density[9:13]
x.coord<-c(63, 68, 68, rep(67:64, each = 2), 63)
y.coord<-c(rep(0, 2), rep(rev(y), each = 2))
list(x.coord, y.coord)
hist(crimtab.2.long.df$height, breaks = 55:78, probability = TRUE, main = main.title, xlab = x.lab, ylab = y.lab)
abline(v = c(63, 68), lty = 2, col = "red")
polygon(x.coord, y.coord, density = 20)
```

키의 평균과 표준편차 구하기
```{r}
summary(crimtab.2.long.df$height)
sd(crimtab.2.long.df$height)
```

```{r}
(x <- c(63, 64:67, 68))
y
diff(x)
diff(x) * y
sum(diff(x) * y)
```

Comparison with normal curve
•이론적인 정규분포 밀도함수 곡선을 히스토그램에 덧붙여 그림.
```{r}
mean.height <- mean(crimtab.2.long.df$height)
sd.height <- sd(crimtab.2.long.df$height)
x.height <- seq(55, 78, length = 1000)
y.norm <- dnorm(x.height, mean = mean.height, sd = sd.height)
hist(crimtab.2.long.df$height, breaks = 55:78, probability = TRUE, main = main.title, xlab = x.lab, ylab = y.lab)
abline(v = c(63, 68), lty = 2, col = "red")
polygon(x.coord, y.coord, density = 20)
lines(x.height, y.norm, col = "red")
axis(side = 1, at = seq(55, 78, by = 2), labels = seq(55, 78, by = 2))
axis(side = 2)
```

ggplot

Basic histogram
```{r}
(g1 <- ggplot(data.frame(crimtab.2.long.df$height), aes(x = crimtab.2.long.df$height)) + geom_histogram(aes(y = ..density..), binwidth = 1, breaks = 55:78, fill = "white", colour = "black"))
```

Mean ±±SD
```{r}
 (g2 <- g1 + geom_vline(xintercept = c(63, 68), linetype = "dotted", colour = "red")) 
```

x-axis label and main title
```{r}
(g3 <- g2 + theme_bw() + xlab("Inches") + ggtitle("The historgram of height in crimtab"))
```

Shading the area
```{r}
(g4 <- g3 + geom_polygon(aes(x = x.coord, y = y.coord), data = data.frame(x.coord, y.coord), alpha = 0.3, fill = "red"))
```

Normal curve added
```{r}
x.curve <- seq(55, 78, length = 100)
y.curve <- dnorm(x.curve, mean = mean.height, sd = sd.height)
(g5 <- g4 + geom_line(aes(x = x.curve, y = y.curve), data = data.frame(x.curve, y.curve), colour = "blue"))
(g6 <- g5 + scale_x_continuous(breaks = seq(55, 78, by = 2), labels = seq(55, 78, by = 2)))
````

##손가락 정규곡선 그리기. 

```{r}
hist(crimtab.2.long.df$finger, probability = TRUE)
(crimtab.finger <- hist(crimtab.2.long.df$finger, plot = FALSE))
list(breaks = crimtab.finger$breaks, counts = crimtab.finger$counts, density = crimtab.finger$density, mids = crimtab.finger$mids)
```

•히스토그램을 보기 쉽게 하기 위해서 메인 타이틀과 서브 타이틀, x축 라벨, y축 라벨 설정
```{r}
main.title <- "The historgram of figner in crimtab"
x.lab <- "Inches"
y.lab <- "Proportion"
hist(crimtab.2.long.df$finger, nclass=19, probability = TRUE, main = main.title, xlab = x.lab, ylab = y.lab)
abline(v = c(11, 12), lty = 2, col = "red")
```

그 사이의 빗금영역을 표시하기 위하여 다각형의 좌표계산
```{r}
crimtab.finger$density[4:6]
y <- crimtab.finger$density[4:6]
```

•5개의 직사각형으로 파악하고 향후 면적 계산을 쉽게 하기 위하여 다음과 같이 좌표 설정
```{r}
x.coord<-c(11, 12, 12, rep(12:11, each = 2), 11)
y.coord<-c(rep(0, 2), rep(rev(y), each = 2))
hist(crimtab.2.long.df$finger, nclass=19, probability = TRUE, main = main.title, xlab = x.lab, ylab = y.lab)
abline(v = c(11, 12), lty = 2, col = "red")
polygon(x.coord, y.coord, density = 20)
```

키의 평균과 표준편차 구하기
```{r}
summary(crimtab.2.long.df$finger)
sd(crimtab.2.long.df$finger)
```


```{r}
(x <- c(11, 11:12, 12))
y
diff(x)
diff(x) * y
sum(diff(x) * y)
```

Comparison with normal curve
•이론적인 정규분포 밀도함수 곡선을 히스토그램에 덧붙여 그림.
```{r}
mean.finger <- mean(crimtab.2.long.df$finger)
sd.finger <- sd(crimtab.2.long.df$figner)
x.finger <- seq(9.5, 13.5, length = 1000)
y.norm <- dnorm(x.finger, mean = mean.finger, sd = sd.finger)
hist(crimtab.2.long.df$finger, nclass=19, probability = TRUE, main = main.title, xlab = x.lab, ylab = y.lab)
abline(v = c(11, 12), lty = 2, col = "red")
polygon(x.coord, y.coord, density = 20)
lines(x.height, y.norm, col = "red")
axis(side = 1, at = seq(9.5, 13.5, by = 1), labels = seq(9.5, 13.5, by = 1))
axis(side = 2)
```

Basic histogram
```{r}
(g1 <- ggplot(data.frame(crimtab.2.long.df$finger), aes(x = crimtab.2.long.df$finger)) + geom_histogram(aes(y = ..density..), binwidth = 1, breaks = 9.5:13.5, fill = "white", colour = "black"))
```

Mean ±±SD
```{r}
 (g2 <- g1 + geom_vline(xintercept = c(11, 12), linetype = "dotted", colour = "red")) 
```

x-axis label and main title
```{r}
(g3 <- g2 + theme_bw() + xlab("Inches") + ggtitle("The historgram of finger in crimtab"))
```

Shading the area
```{r}
(g4 <- g3 + geom_polygon(aes(x = x.coord, y = y.coord), data = data.frame(x.coord, y.coord), alpha = 0.3, fill = "red"))
```

Normal curve added
```{r}
x.curve <- seq(9.5, 13.5, length = 100)
y.curve <- dnorm(x.curve, mean = mean.finger, sd = sd.finger)
(g5 <- g4 + geom_line(aes(x = x.curve, y = y.curve), data = data.frame(x.curve, y.curve), colour = "blue"))
(g6 <- g5 + scale_x_continuous(breaks = seq(9.5, 13.5, by = 1), labels = seq(9.5, 13.5, by = 1)))
````

### ggplot

* •키와 손가락 길이의 산점도 

```{r, fig.width = 8, fig.height = 4}
library(ggplot2)
ggplot(crimtab.2.long.df, aes(x = height, y = finger)) + geom_point()
ggplot(crimtab.2.long.df, aes(x = height, y = finger)) + geom_point(alpha = 0.9)
ggplot(crimtab.2.long.df, aes(x = height, y = finger)) + geom_point(alpha = 0.5)
ggplot(crimtab.2.long.df, aes(x = height, y = finger)) + geom_point(alpha = 0.1)
ggplot(crimtab.2.long.df, aes(x = height, y = finger)) + geom_point(position = "jitter")
ggplot(crimtab.2.long.df, aes(x = height, y = finger)) + geom_point(position = "jitter", size = 0.7)
ggplot(crimtab.2.long.df, aes(x = height, y = finger)) + geom_point(position = position_jitter(), size = 0.7)
ggplot(crimtab.2.long.df, aes(x = height, y = finger)) + geom_point(position = position_jitter(width = 1, height = 0), size = 0.7)
ggplot(crimtab.2.long.df, aes(x = height, y = finger)) + geom_point(position = position_jitter(width = 1, height = 0.1), size = 0.7)
ggplot(crimtab.2.long.df, aes(x = height, y = finger)) + geom_point(position = position_jitter(width = 1, height = 0.1), size = 0.7) +
  theme_bw()
```


### Data 마무리

```{r}
# save.image(file="../R/crimtab_1007.rda")
# cor(crimtab.2.long[,1], crimtab.2.long[,2])
```